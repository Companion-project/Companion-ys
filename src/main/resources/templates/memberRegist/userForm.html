<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script src="/static/js/daumAddressScript.js"></script>
</head>
<body>
<!--
th:object, th:value를 통해 오류가 있어 되돌아 올 경우 입력값을 다시 출력하도록 설정해줌.
-->

<form action="userRegist" method="post" id="frm" th:object="${memberCommand}">
    회원아이디 : <input type="text" name="memberId" id="memberId" /><br/>
    <span style="color:red" th:if="${#fields.hasErrors('memberId')}" th:errors="*{memberId}"></span><br/>

    <span id='idCheck'></span><br/>

    회원비밀번호 : <input type="password" name="memberPw"/><br/>
    <span style="color:red" th:if="${#fields.hasErrors('memberPw')}" th:errors="*{memberPw}"></span><br/>

    회원비밀번호 확인 : <input type="password" name="memberPwCon"/><br/>
    <span style="color:red" th:if="${#fields.hasErrors('memberPwCon')}" th:errors="*{memberPwCon}"></span><br />

    회원이름 : <input type="text" name="memberName" th:value="${memberCommand.memberName}"/><br/>
    <span style="color:red" th:if="${#fields.hasErrors('memberName')}" th:errors="*{memberName}"></span><br/>

    회원주소 : <input type="text" name="memberAddr" id="sample4_roadAddress" onclick="execDaumPostcode();" th:value="${memberCommand.memberAddr}"/><br/>
    <span style="color:red" th:if="${#fields.hasErrors('memberAddr')}" th:errors="*{memberAddr}"></span><br/>

    회원상세주소 : <input type="text" name="memberAddr2" th:value="${memberCommand.memberAddr2}"/><br/>
    우편번호 : <input type="text" name="memberPost" id="sample4_postcode" th:value="${memberCommand.memberPost}" /><br/>

    성별 : <input type="radio" name="memberGender" value="M"/>남자
          <input type="radio" name="memberGender" value="F"/>여자<br/>

    연락처1 : <input type="tel" name="memberPhone1" th:value="${memberCommand.memberPhone1}"/><br/>
    <span style="color:red" th:if="${#fields.hasErrors('memberPhone1')}" th:errors="*{memberPhone1}"></span><br/>

    연락처2 : <input type="tel" name="memberPhone2" th:value="${memberCommand.memberPhone2}"/><br/>
    <span style="color:red" th:if="${#fields.hasErrors('memberPhone2')}" th:errors="*{memberPhone2}"></span><br/>

    이메일 : <input type="email" name="memberEmail" id="memberEmail" th:value="${memberCommand.memberEmail}"/><br/>
    <span style="color:red" th:if="${#fields.hasErrors('memberEmail')}" th:errors="*{memberEmail}"></span><br/>
    <span id='emailCheck'></span><br/>

    생년월일 : <input type="date" name="memberBirth" th:value="${#dates.format(memberCommand.memberBirth, 'yyyy-MM-dd')}"/><br/>
    <span style="color:red" th:if="${#fields.hasErrors('memberBirth')}" th:errors="*{memberBirth}"></span><br/>

    <input type="submit" value="회원등록"/>



</form>


<script type="text/javascript">
    $(function(){
        $("#memberId").on("change keyup", function(){
            var memberId = $("#memberId").val();
            var memberIdPattern = /^[a-z0-9]{5,20}$/;

            //아이디 유효성 검사
            if(!memberIdPattern.test(memberId)){
            $("#idCheck").text("아이디는 영어 소문자와 숫자만 사용하여 5~20글자 내에서 입력하세요.")
                .css("color","red");
                return;
            }

            //아이디 중복 검사
            $.ajax({
                type:'post',
                url:"/login/userIdCheck",
                data:{"userId":$("#memberId").val()},
                dataType:'text',
                success: function(result){
                    $("#idCheck").text(result);
                    if(result.trim() == "사용가능한 아이디입니다."){
                        $("#idCheck").css("color","blue");
                    }else{
                        $("#idCheck").css("color","red");
                    }
                },
                error:function(){
                }
            });
        });

    $("#memberEmail").on("change keyup", function(){
        $.ajax({
            type:'post',
            url:"/checkRest/userEmailCheck",
            data:{"userEmail":$("#memberEmail").val()},
            dataType:'text',
            success: function(result){
                $("#emailCheck").text(result);
                if(result.trim() == "사용가능한 이메일입니다."){
                    $("#emailCheck").css("color","blue");
                }else{
                    $("#emailCheck").css("color","red");
                }
            },
            error:function(){
            }
        });
    });

    //회원가입 시 사용할 수 없는 아이디, 이메일은 전송하지 못하도록 차단
    $("#frm").submit(function(){
        if($("#idCheck").text() == "" || $("#idCheck").text() == "사용중인 아이디입니다."){
            alert("아이디 중복확인 필요");
            return false;
        }
        if($("#emailCheck").text() == "" || $("emailCheck").text() == "사용중인 이메일입니다."){
            alert("이메일 중복확인 필요");
            return false;
        }
    });
});
</script>
</body>
</html>